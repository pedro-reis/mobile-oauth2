<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="format-detection" content="telephone=no" />
        <meta name="msapplication-tap-highlight" content="no" />
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height" />
		<link rel="stylesheet" href="js/jquery.mobile-1.4.5.min.css">
		<link rel="stylesheet" href="js/demos/_assets/css/jqm-demos.css">		
        <link rel="stylesheet" type="text/css" href="css/index.css" />
		<script src="js/demos/js/jquery.js"></script>
		<script src="js/jquery.mobile-1.4.5.min.js"></script>
		<!-- <script src="js/cordova.oauth2.js"></script> -->
        <title>mobile-oAuth2</title>
    </head>
    <body>
			<div id="page-nav" data-role="navbar" style="display: none">
				<ul>
					<li><a href="#" class="ui-btn-active" onclick="menu_switch('#page1')">Test Form</a></li>
					<li><a href="#" onclick="menu_switch('#page2')">About</a></li>
				</ul>
			</div>

		<div class="app">

			<div id="page0">

				<div id="deviceready" class="blink">
				<img src="i/logo.png" border="0" />
				</div>
				<br />
				<h3>Mobile oAuth2 Client</h3>
				<br />
				
				<a href="#" class="ui-btn ui-btn-inline" onclick="menu_switch('#page1'); oauth2_init();">Authentication</a>
			
			</div>
		
			<div id="page1" style="display: none">
		
				<h1>mobile oAuth2</h1>
							
				<br />			
							
				<form name="form" id="form">
				
				
					<div id="logs"></div>
				
				<!--
					<label for="textinput-disabled">Text Input:</label>
					<input  type="text" name="textinput-disabled" id="textinput-disabled" placeholder="Text input" value="">
				
					<br /><br />
				
					<label for="text-basic">Text input:</label>
					<input type="text" name="text-basic" id="text-basic" value="" >
				
					<br /><br />

					<input type="button" name="button" id="button" value="Button" onclick="func_copy()">
				-->
					
				
				</form>
				
			</div>
			
			<div id="page2" style="display: none">
				
				
			
			
			
			</div>
			
        </div>
		
		<script>
		
			
			var authToken = '';
		
			function oauth2_init()
			{
				$.post("http://194.38.143.16/authorize.php",
				{
					response_type: "code",
					client_id: "testclient",
					client_secret: "testpass",
					state: "xyz"
				},
				function(data, status){
					var options;
					
					var ref = window.open(encodeURI('http://194.38.143.16/login_android.php?code=' + data), '_blank', options); 
					
					ref.addEventListener('loadstop', function(event) 
					{
						if (event.url.match(/(\/?[^?]*?)(\?)(token=)(.*)/)) 
						{
							match = event.url.match(/(\/?[^?]*?)(\?)(token=)(.*)/);
							
							//alert(match[4]);
							
							authToken = match[4];
							
							$('#logs').html("<b>Token:</b> " + match[4]);
							
							ref.close(); 
						}
						/*
						if (event.url.match('(close)(\?|\&)([^=]+)\=([^&]+)')) 
						{
							match = event.url.match('(close)(\?|\&)([^=]+)\=([^&]+)');
							
							alert(match[4]);
							
							ref.close(); 
						}
						*/						
					});
					
					
					
					//window.open("http://194.38.143.16/login_android.php?code=" + data);
					
				});
			};
			
			
			
			/*
			function oauth2_init() {
				$.oauth2({
					auth_url: 'http://194.38.143.16/authorize.php',           // required
					response_type: 'code',      // required - "code"/"token"
					token_url: 'http://194.38.143.16/token.php',          // required if response_type = 'code'
					logout_url: '',         // recommended if available
					client_id: 'testclient',          // required
					client_secret: 'testepass',      // required if response_type = 'code'
					redirect_uri: '#',       // required - some dummy url
					other_params: {state: 'xyz'}        // optional params object for scope, state, display...
				}, function(token, response){
					// do something with token or response
					$("#logs").append("<p class='success'><b>access_token: </b>"+token+"</p>");
					$("#logs").append("<p class='success'><b>response: </b>"+JSON.stringify(response)+"</p>");
				}, function(error, response){
					// do something with error object
					$("#logs").append("<p class='error'><b>error: </b>"+JSON.stringify(error)+"</p>");
					$("#logs").append("<p class='error'><b>response: </b>"+JSON.stringify(response)+"</p>");
				}); 
			}
			*/
			
			
		
		
		
		
			/*
			$('#text-basic').change(function(){
				$('#textinput-disabled').val('ssss');
		
			});
			*/
		

			function func_copy ()
			{
				$('#textinput-disabled').val($('#text-basic').val());
			
			}
			
		
			function menu_switch (page)
			{
				$('#page0').hide();
				$('#page1').hide();
				$('#page2').hide();
				$('#page-nav').show();
				$(page).show();
			};
			
		
		</script>
		
		
        <script type="text/javascript" src="cordova.js"></script>
        <script type="text/javascript" src="js/index.js"></script>
        <script type="text/javascript">
            <!-- app.initialize(); -->
        </script>
    </body>
</html>
